<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Lesson Plan - Edu Mate</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/lessonplan.css') }}?v=20250816">
  
  <!-- MathJax cho LaTeX trong lesson plans -->
  <script>
    window.MathJax = {
      tex: {
        inlineMath: [['$', '$'], ['\\(', '\\)']],
        displayMath: [['$$', '$$'], ['\\[', '\\]']],
        processEscapes: true,
        processEnvironments: true,
        packages: {'[+]': ['ams', 'newcommand', 'configMacros']},
        macros: {
          R: "{\\mathbb{R}}",
          N: "{\\mathbb{N}}",
          Z: "{\\mathbb{Z}}",
          Q: "{\\mathbb{Q}}",
          C: "{\\mathbb{C}}"
        }
      },
      svg: {
        fontCache: 'global'
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code'],
        processHtmlClass: 'tex2jax_process',
        ignoreHtmlClass: 'tex2jax_ignore'
      },
      startup: {
        ready: function() {
          MathJax.startup.defaultReady();
          console.log('MathJax s·∫µn s√†ng cho Lesson Plan!');
        }
      }
    };
  </script>
  <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
</head>

<body>
  <div class="header">
    <div class="header-left">
      <a class="btn ghost" href="/chat">‚Üê V·ªÅ Chat</a>
      <h2>ü§ñ Edu Mate ‚Äî Lesson Plan</h2>
    </div>
    <div class="status-indicator">
      <div class="status-dot"></div><span>S·∫µn s√†ng</span>
    </div>
  </div>

  <div class="main">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h3>üìö K·∫ø ho·∫°ch</h3>
        <button class="btn primary" onclick="openCreate()">T·∫°o m·ªõi</button>
      </div>
      <div id="list" class="list">
        <div class="item-empty">Ch∆∞a c√≥ k·∫ø ho·∫°ch n√†o</div>
      </div>
    </aside>

    <section class="content">
      <div class="toolbar">
        <div id="title" class="toolbar-title">Ch·ªçn m·ªôt b√†i gi·∫£ng ƒë·ªÉ xem</div>
        <div class="toolbar-actions">
          <a class="btn" href="/chat">Chat AI</a>
          <button class="btn" id="editBtn" onclick="toggleEdit()" disabled>Ch·ªânh s·ª≠a</button>
          <button class="btn slide" id="createSlideBtn" onclick="createSlide()" disabled>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <rect x="3" y="4" width="18" height="12" rx="2" ry="2"></rect>
              <line x1="2" y1="20" x2="22" y2="20"></line>
            </svg>
            T·∫°o slide
          </button>
          <button class="btn primary" id="saveBtn" onclick="save()" style="display:none;">üíæ L∆∞u</button>
          <a class="btn" id="downloadBtn" href="#" target="_blank" rel="noopener" style="display:none;">‚¨áÔ∏è T·∫£i
            Markdown</a>
          <button class="btn danger" id="removeBtn" onclick="removePlan()" disabled>üóë Xo√°</button>
        </div>
      </div>

      <div id="container" class="container-pad">
        <article id="viewer" class="viewer doc tex2jax_process">
          <div class="empty">Ch∆∞a c√≥ b√†i gi·∫£ng n√†o ƒë∆∞·ª£c ch·ªçn</div>
        </article>
        <textarea id="editor" class="editor" placeholder="Nh·∫≠p Markdown k·∫ø ho·∫°ch b√†i gi·∫£ng..."></textarea>
      </div>
    </section>
  </div>

  <!-- Modal t·∫°o m·ªõi -->
  <div id="modal" class="modal" aria-hidden="true">
    <div class="modal__inner">
      <h3>üÜï T·∫°o b√†i gi·∫£ng m·ªõi</h3>
      <form id="createForm">
        <div class="field"><label>Ti√™u ƒë·ªÅ</label><input id="f_title" required placeholder="VD: B√†i 1: S·ªë h·ªØu t·ªâ"></div>
        <div class="field"><label>M√¥n h·ªçc</label><input id="f_subject" required placeholder="VD: To√°n h·ªçc"></div>
        <div class="field"><label>L·ªõp</label><input id="f_grade" required placeholder="VD: 10"></div>
        <div class="field"><label>Th·ªùi gian (ph√∫t)</label><input id="f_duration" type="number" value="45" min="1"
            max="180"></div>
        <div class="modal-actions">
          <button type="button" class="btn ghost" onclick="closeCreate()">Hu·ª∑</button>
          <button class="btn primary" type="submit">T·∫°o</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal t·∫°o slide -->
  <div id="slideModal" class="modal" aria-hidden="true">
    <div class="modal__inner">
      <h3>üìä T·∫°o slide t·ª´ k·∫ø ho·∫°ch b√†i gi·∫£ng</h3>
      <div class="slide-preview">
        <div class="slide-info">
          <p><strong>B√†i gi·∫£ng:</strong> <span id="slideTitle">-</span></p>
          <p><strong>S·ªë slide d·ª± ki·∫øn:</strong> <span id="slideCount">-</span></p>
        </div>
        <div class="slide-options">
          <div class="field">
            <label>Template slide</label>
            <select id="slideTemplate">
              <option value="modern">Modern - Hi·ªán ƒë·∫°i</option>
              <option value="classic">Classic - C·ªï ƒëi·ªÉn</option>
              <option value="minimal">Minimal - T·ªëi gi·∫£n</option>
            </select>
          </div>
          <div class="field">
            <label>ƒê·ªãnh d·∫°ng xu·∫•t</label>
            <select id="slideFormat">
              <option value="pptx">PowerPoint (.pptx)</option>
              <option value="html">HTML Slide</option>
              <option value="pdf">PDF</option>
            </select>
          </div>
        </div>
      </div>
      <div class="modal-actions">
        <button type="button" class="btn ghost" onclick="closeSlideModal()">Hu·ª∑</button>
        <button class="btn slide" onclick="generateSlide()">
          <div class="btn-loading" style="display: none;">
            <div class="spinner"></div>
            ƒêang t·∫°o...
          </div>
          <span class="btn-text">üé® T·∫°o slide</span>
        </button>
      </div>
    </div>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite"></div>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dompurify@3.1.6/dist/purify.min.js"></script>

  <script type="application/json" id="plansData">{{ plans | default([], true) | tojson | safe }}</script>

  <script src="{{ url_for('static', filename='js/lessonplan.js') }}?v=20250816"></script>
</body>

</html>